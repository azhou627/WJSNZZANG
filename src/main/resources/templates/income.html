<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>集资首页</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>
<div class="page-header" align="center">
    <h1>宇你有管集资涨幅</h1>
    <h2 id="refresh"></h2>
</div>

<div class="container" style="width: 80%;align-content: center">
    <table class="table table-striped" id="monthIncome"></table>
</div>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div class="container" id="dayIncome" style="width: 800px;height:400px;align-content: center"></div>
<div class="container" id="weekIncome" style="width: 800px;height:400px;align-content: center"></div>
<div class="container" style="width: 50%;align-content: center">
    <h3 align="center">个人集资排名</h3>
    <table class="table table-striped" id="rank"></table>
</div>

<script src="js/jquery-3.5.1.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/echart.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.15.3/dist/bootstrap-table.min.js"></script>

<script type="text/javascript">

    var dayChart = echarts.init(document.getElementById('dayIncome'));
    // 显示标题，图例和空的坐标轴
    dayChart.setOption({
        title: {
            text: '日涨幅'
        },
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data:['金额']
        },
        xAxis: {
            type: 'category',
            data: []
        },
        yAxis: {
            type: 'value'
        },
        series: [{
            name: '金额',
            type: 'line',
            smooth: true,
            data: []
        }]
    });

    dayChart.showLoading();    //数据加载完之前先显示一段简单的loading动画

    $.ajax({
        type : "post",
        async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
        url : "/income/day",    //请求发送到TestServlet处
        data : {},
        dataType : "json",        //返回数据形式为json
        success : function(result) {
            //请求成功时执行该函数内容，result即为服务器返回的json对象
            let dDates=[];    //类别数组（实际用来盛放X轴坐标值）
            let dIncomes=[];    //销量数组（实际用来盛放Y坐标值）
            if (result.code == '0') {
                let data = result.data;
                for(let i=0;i<data.length;i++){
                    dDates.push(data[i].date);
                    dIncomes.push(data[i].income);
                }
                dayChart.hideLoading();    //隐藏加载动画
                dayChart.setOption({        //加载数据图表
                    xAxis: {
                        data: dDates
                    },
                    series: [{
                        // 根据名字对应到相应的系列
                        name: '金额',
                        data: dIncomes
                    }]
                });

                var refreshTime = "更新时间：" + dDates[dDates.length-1];
                $('#refresh').html(refreshTime);

            }
        },
        error : function(errorMsg) {
            //请求失败时执行该函数
            alert("图表请求数据失败!");
            dayChart.hideLoading();
        }
    })

    var weekChart = echarts.init(document.getElementById('weekIncome'));
    // 显示标题，图例和空的坐标轴
    weekChart.setOption({
        title: {
            text: '周涨幅'
        },
        tooltip: {
            trigger: 'axis'
        },
        legend: {
            data:['金额']
        },
        xAxis: {
            type: 'category',
            data: []
        },
        yAxis: {
            type: 'value'
        },
        series: [{
            name: '金额',
            type: 'line',
            smooth: true,
            data: []
        }]
    });

    weekChart.showLoading();    //数据加载完之前先显示一段简单的loading动画

    var wDates=[];    //类别数组（实际用来盛放X轴坐标值）
    var wIncomes=[];    //销量数组（实际用来盛放Y坐标值）

    $.ajax({
        type : "post",
        async : true,            //异步请求（同步请求将会锁住浏览器，用户其他操作必须等待请求完成才可以执行）
        url : "/income/week",    //请求发送到TestServlet处
        data : {},
        dataType : "json",        //返回数据形式为json
        success : function(result) {
            //请求成功时执行该函数内容，result即为服务器返回的json对象
            if (result.code == '0') {
                let data = result.data;
                for(let i=0;i<data.length;i++){
                    wDates.push(data[i].date);
                    wIncomes.push(data[i].income);
                }
                weekChart.hideLoading();    //隐藏加载动画
                weekChart.setOption({        //加载数据图表
                    xAxis: {
                        data: wDates
                    },
                    series: [{
                        // 根据名字对应到相应的系列
                        name: '金额',
                        data: wIncomes
                    }]
                });

            }
        },
        error : function(errorMsg) {
            //请求失败时执行该函数
            alert("图表请求数据失败!");
            weekChart.hideLoading();
        }
    });

    $.get('/income/getRank', function(result){
        if(result.code == '0'){
            let datalist = result.data;
            $('#rank').bootstrapTable({
                data: datalist,
                columns :  [{
                    field :  'qq' ,
                    title :  'QQ',
                    align: 'center',
                    valign: 'middle'
                },  {
                    field :  'income' ,
                    title :  '金额',
                    align: 'center',
                    valign: 'middle'
                }]
            });
            $('#rank').bootstrapTable('hideLoading');
        }

    });

    $.get('/income/month', function (result) {
        let mData = result.data;
        let colData;
        let myColumns;
        let sum = 0;
        if (result.code == "0") {
            myColumns = [{
                "field": '日期',
                "title": '日期',
                "align": 'center',
                "valign": 'middle'
            }];
            colData = [{"日期":'月涨幅'}];
            for (let i = 0; i < mData.length; i++){
                sum += mData[i].income;
                myColumns.push({
                    "field": mData[i].date,
                    "title": mData[i].date,
                    "align": 'center',
                    "valign": 'middle'
                });
                let na = mData[i].date.toString();
                colData[0][na] = mData[i].income;
            }
            myColumns.push({
                "field": '总计',
                "title": '总计',
                "align": 'center',
                "valign": 'middle'
            });
            colData[0]['总计'] = sum;
            console.log(colData);
            $('#monthIncome').bootstrapTable({
                data: colData,
                columns :  myColumns
            });
            $('#monthIncome').bootstrapTable('hideLoading');
        }
    });

</script>
</body>
</html>